<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
	
<head>
    <meta charset="UTF-8">
	<link rel="stylesheet" th:href="@{/style.css}">
	<!-- Font Awesome -->
	<link rel="stylesheet" 
	      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">


    <title>買い物リスト</title>

	
	
	<!-- ★ CSRF無効化の場合、コメントアウト -->
	    <!--
	<meta name="_csrf" th:content="${_csrf.token}">
	<meta name="_csrf_header" th:content="${_csrf.headerName}">
	-->
</head>
<body>
	<h1 style="text-align:center; font-family: 'Comic Sans MS', cursive;">📝 買い物リスト</h1>

	<!-- 新規追加ボタン -->
	<button type="button" class="button" onclick="openNewItemModal()">買い物リストに新規追加</button>

	
	<div class="memo-container">
		
	<div id="message" style="text-align:center; margin:10px 0; color:green;"></div>	

	    <table>
	        <tr>
	            <th>✔</th>
	            <th>食材</th>
	            <th>量</th>
	            <th class="hidden">カテゴリ</th>
	            <th class="hidden">購入日</th>
	            <th class="hidden">購入済み</th>
				<th></th>
	        </tr>

	        <tr th:each="item : ${listItems}">
	            <td><input type="checkbox" name="selectedItems"></td>
	            <td>
	                <span th:text="${item.name}"></span>
	                <span class="pencil">✏️</span>
	            </td>
	            <td th:text="${item.amount}"></td>
	            <td class="hidden" th:text="${item.categoryName}"></td>
	            <td class="hidden" th:text="${item.purchaseDate}"></td>
	            <td class="hidden" th:text="${item.purchasedFlg}"></td>
	            <td>
					<!-- ★JSに値を渡す -->
					<button type="button" class="button"
					        th:attr="data-id=${item.id}, data-name=${item.name}"
							onclick="openModal(this.dataset.id, this.dataset.name)">
					    購入済みにする
					</button>
	            </td>
	        </tr>
	    </table>
	</div>

	<!-- 戻るボタン -->
	<button type="button" onclick="goBack()" class="button">食材一覧へ戻る</button>
	
	<!-- ★購入済みポップアップ -->
	<div id="purchasedModal" class="modal-overlay" style="display:none;">
	    <div class="modal-content">
	        <h2>購入済み → 食材として登録</h2>

	        <form id="purchasedForm">
	            <input type="hidden" name="shoppingListId" id="shoppingListId">

	            <div>
	                <label>食材名：</label>
					<!-- ★JSでセット -->
					 <input type="text" id="itemName" name="itemName" readonly>
	            </div>
				
				<div>
				    <label>カテゴリー：</label>
				    <select id="categoryId" name="categoryId" required>
				        <option value="">-- 選択してください --</option>
				        <option th:each="cat : ${categories}" 
				                th:value="${cat.id}" 
				                th:text="${cat.name}">
				        </option>
				    </select>
				</div>

	            <div>
	                <label>量：</label>
	                <input type="text" id="amount" name="amount" required>
	            </div>

	            <div>
	                <label>期限：</label>
	                <input type="date" id="deadline" name="deadline">
	            </div>

	            <div>
	                <label>メモ：</label>
	                <input type="text" id="others" name="others">
	            </div>

				<div class="form-row">
				    <label>お気に入り：</label>
				    <div style="display:flex; align-items:center; gap:8px;">
				        <button type="button" id="modalFavoriteButton" class="heart-btn heart-home">
				            <i class="fa-solid fa-heart"></i>
				        </button>
				        <input type="hidden" id="modalFavoriteField" name="favoriteFlg" value="0">
				    </div>
				</div>



	            <div class="modal-buttons">
	                <button type="button" onclick="submitPurchased()">食材一覧へ追加</button>
	                <button type="button" onclick="closeModal()">キャンセル</button>
	            </div>
	        </form>
	    </div>
	</div>
	
	<!-- 新規追加用モーダル -->
	<div id="newItemModal" class="modal-overlay" style="display:none;">
	    <div class="modal-content">
	        <h2>新しい食材を追加</h2>

	        <form id="newItemForm">
	            <div>
	                <label>食材名：</label>
	                <input type="text" id="newItemName" name="name" required>
	            </div>

	            <div>
	                <label>量：</label>
	                <input type="text" id="newItemAmount" name="amount" required>
	            </div>

	            <div class="modal-buttons">
	                <button type="button" onclick="submitNewItem()">追加</button>
	                <button type="button" onclick="closeNewItemModal()">キャンセル</button>
	            </div>
	        </form>
	    </div>
	</div>

	
	<script src="/js/shoppingList.js"></script>

</body>
</html>
